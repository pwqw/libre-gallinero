#!/data/data/com.termux/files/usr/bin/bash
# -*- coding: utf-8 -*-
# Shortcut para buscar ESP8266 en la red local usando nmap
# Optimizado para Termux/Android

set -e
set -u

# Cambiar al directorio del proyecto
cd "$HOME/libre-gallinero" || {
    printf "âŒ Error: No se encontrÃ³ el directorio libre-gallinero\n"
    printf "   Ejecuta primero: bash termux/termux-setup.sh\n\n"
    read -p "Presiona Enter para cerrar..."
    exit 1
}

# Cargar funciones comunes
source "$HOME/libre-gallinero/termux/common.sh"

print_banner "ğŸ” BUSCAR ESP8266 EN LA RED ğŸ”"

# Verificar que exista .env
if [ ! -f .env ]; then
    printf "ğŸ“„ No existe .env, creando desde .env.example...\n\n"
    if [ -f .env.example ]; then
        cp .env.example .env
        printf "âœ… .env creado\n"
        printf "âš ï¸  Recuerda configurar WEBREPL_PASSWORD si es diferente\n\n"
    else
        pause_error "No existe .env.example"
        exit 1
    fi
fi

# Ejecutar scanner de ESP8266
printf "ğŸ” Escaneando red local...\n\n"

if python3 tools/find_esp8266.py; then
    pause
else
    pause_error "Escaneo fallÃ³"
fi
